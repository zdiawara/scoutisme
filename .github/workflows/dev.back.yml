name: Deployer Back [DEV] # Nom de la t√¢che dans GitHub
on:
  workflow_dispatch: # Ev√©nement d√©clencheur de la t√¢che, en l‚Äôoccurrence, il s‚Äôagit d‚Äôun d√©clenchement manuel
    inputs:
      migrate_seed:
        type: choice
        description: 'Run migrate and seeder ?'
        required: true
        options:
          - 'true'
          - 'false'
        default: 'false'
jobs:
  Deploiement:
    runs-on: ubuntu-latest # OS sur lequel va s‚Äôex√©cuter la t√¢che
    defaults:
      run:
        working-directory: ./back
    steps:
      - name: Check out repository code # r√©cup√©ration du d√©p√¥t GitHub dans la machine
        uses: actions/checkout@v3
      - name: Setup PHP # Configuration de PHP sur la machine virtuelle
        uses: shivammathur/setup-php@v2
        with:
          php-version: "7.2.5" # Je propose d‚Äôutiliser la version 8.0
      - name: Install PHP dependencies # Installation des paquets composer
        uses: "ramsey/composer-install@v2"
        with:
          dependency-versions: "locked" # Installation en utilisant le fichier composer.lock
          working-directory: "back"
      #- name: Deploiement # Ex√©cution de Deployer. A partir de l√†, c‚Äôest le script cr√©√© dans la partie 1 de l‚Äôarticle qui prend le relais.
      #  run: cd ${{ github.workspace }} && php vendor/bin/dep deploy ftp.mondomaine.com

      - name: üìÇ Sync files
        uses: SamKirkland/FTP-Deploy-Action@4.1.0
        with:
          server: 109.234.166.84
          username: ytav8401
          password: dj5V-NQ7u-duC?
          local-dir: /home/runner/work/burval/burval/back/
          server-dir: dev.burvalgroup.com/backend/
      - name: Copy env file
        run: cp .env.dev .env
      ## If migrate and seed
      - if: github.event.inputs.migrate_seed == 'true'
        name: Runing migrate and seed
        run: php artisan migrate:fresh --seed
